name: ğŸ iOS CI

on:
  pull_request:
    branches: [ main ]

jobs:
  ios-build-test:
    name: Build and Test
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v4

    # 1ï¸âƒ£ Tuist ì„¤ì¹˜
    - name: Install Tuist (brew)
      run: |
        brew update
        brew tap tuist/tuist
        brew install tuist
        
    - name: Add Tuist to PATH
      run: echo "$HOME/.tuist/bin" >> $GITHUB_PATH

    - name: Clean workspace completely
      run: |
        rm -rf *.xcodeproj
        rm -rf *.xcworkspace
        rm -rf .package.resolved
        rm -rf **/Package.resolved
        
    # 2ï¸âƒ£ í”„ë¡œì íŠ¸ ìƒì„± (workspace, scheme ìë™ ìƒì„±)
    - name: Generate Xcode project with Tuist
      run: tuist generate --no-open --no-binary-cache

    # 3ï¸âƒ£ ì‹¤ì œ ë¹Œë“œ
    - name: Build project
      run: |
        xcodebuild -workspace MZMZ.xcworkspace \
                   -scheme "MZMZ" \
                   -destination 'platform=iOS Simulator,OS=18.6,name=iPhone 16' \
                   clean build

    # 4ï¸âƒ£ ë©”ì¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    - name: Run MZMZ tests
      run: |
        xcodebuild test \
                   -workspace MZMZ.xcworkspace \
                   -scheme "MZMZ" \
                   -destination 'platform=iOS Simulator,OS=18.6,name=iPhone 16'

    # 5ï¸âƒ£ ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ íƒ€ê¹ƒ ì‹¤í–‰
    - name: Run DustListView tests
      run: |
        xcodebuild test \
                   -workspace MZMZ.xcworkspace \
                   -scheme DustListView \
                   -destination 'platform=iOS Simulator,OS=18.6,name=iPhone 16'
